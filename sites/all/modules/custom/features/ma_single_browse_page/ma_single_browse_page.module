<?php
/**
 * @file
 * Code for the Mukurtu Single Digital Heritage Browse Page feature.
 */

include_once 'ma_single_browse_page.features.inc';

/**
 * Implements hook_block_view_alter().
 */
function ma_single_browse_page_block_view_alter(&$data, $block) {

  // Hide some blocks on the single browse page.
  // Note, other content is being not rendered via page--browse.tpl.php.
  if (current_path() == 'browse') {
    switch ($block->bid) {
      case 'views-communities_content-block_1';
      case 'boxes-ma_site_header';
        $data['content'] = '';
        break;
    }
  }

}


/**
 * Implementation of hook_block_info().
 */
function ma_single_browse_page_block_info() {
  $blocks['single_browse_page_legend'] = array(
    'info' => t('Single Browse Page Legend'),
  );
  $blocks['single_browse_page_filters'] = array(
    'info' => t('Single Browse Page Filters'),
  );
  return $blocks;
}


/**
 * Implementation of hook_block_view().
 */
function ma_single_browse_page_block_view($delta = '') {
  $block = array();

  switch ($delta) {
    case 'single_browse_page_legend':
    $block['subject'] = t('Legend');
    $block['content'] = "content";
    break;

  case 'single_browse_page_filters':
    $block['subject'] = t('Filters');

    $search_form_block  = module_invoke('views', 'block_view','-exp-digital_heritage_grid_list-single_browse_page_dh_list');
    $block['content'] = render($search_form_block['content']);

    $facets_map = array_flip(facetapi_get_delta_map());
    $facet_name_prefix = 'search_api@default_node_index:block:field_';
    $facets_to_render = array (
      'community_ref',
      'collection',
      'category',
      'media_asset%3Atype',
      'tags'
    );
    foreach ($facets_to_render as $facet_to_render) {
      $facet_block = module_invoke('facetapi', 'block_view', $facets_map[$facet_name_prefix . $facet_to_render]);
      $block['content'] .= render($facet_block['content']);;
    }

    break;

  }
  return $block;
}

